
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Walker_V's Notebook">
      
      
        <meta name="author" content="Walker_V">
      
      
        <link rel="canonical" href="https://VictorWang712.github.io/Note/computer_science/computer_organisation/chapter_4/">
      
      
        <link rel="prev" href="../chapter_3/">
      
      
        <link rel="next" href="../chapter_5/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/icons/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>第四章 - 处理器 - Walker_V's Notebook</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/css/card.css">
    
      <link rel="stylesheet" href="../../../stylesheets/css/flink.css">
    
      <link rel="stylesheet" href="../../../stylesheets/css/font.css">
    
      <link rel="stylesheet" href="../../../stylesheets/css/rounded_corner.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@callmebill/lxgw-wenkai-web@latest/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#-" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Walker_V&#39;s Notebook" class="md-header__button md-logo" aria-label="Walker_V's Notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 2h-5v8l-2.5-2.25L8 12V4H6v16h12z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Walker_V's Notebook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第四章 - 处理器
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label=""  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="" for="__palette_1" hidden>
        <?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="1024.000000pt" height="1024.000000pt" viewBox="0 0 1024.000000 1024.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,1024.000000) scale(0.100000,-0.100000)"
fill="currentColor" stroke="none">
<path d="M4099 9390 c-94 -16 -177 -75 -225 -162 l-29 -53 -3 -301 c-3 -286
-2 -303 18 -358 29 -75 100 -147 175 -175 172 -64 365 16 425 175 20 55 21 72
18 358 -3 272 -5 304 -22 336 -72 135 -210 205 -357 180z"/>
<path d="M8750 9164 c-25 -9 -63 -29 -85 -44 -22 -16 -1730 -1720 -3796 -3787
-3386 -3388 -3758 -3763 -3780 -3813 -35 -82 -34 -195 4 -271 32 -66 99 -132
165 -162 72 -33 188 -30 267 6 55 25 372 340 3831 3800 3095 3096 3775 3781
3795 3822 19 41 24 66 24 140 0 78 -4 97 -28 147 -32 65 -90 122 -156 151 -62
28 -180 33 -241 11z"/>
<path d="M1964 8511 c-49 -12 -134 -63 -160 -94 -14 -17 -37 -53 -52 -81 -24
-45 -27 -62 -27 -141 1 -135 22 -169 248 -393 223 -220 250 -237 382 -237 105
0 163 23 230 90 65 64 89 125 89 225 1 135 -17 166 -235 386 -213 214 -256
243 -372 249 -40 3 -86 1 -103 -4z"/>
<path d="M6194 8511 c-76 -20 -136 -67 -317 -250 -220 -222 -232 -243 -232
-376 0 -71 5 -100 21 -136 31 -67 87 -124 152 -156 50 -24 69 -28 147 -28 133
0 159 17 387 244 224 223 243 254 243 391 -1 77 -4 91 -34 148 -38 70 -70 101
-144 138 -54 28 -165 40 -223 25z"/>
<path d="M4020 7893 c-327 -32 -604 -127 -860 -296 -424 -280 -715 -729 -795
-1227 -79 -494 50 -1006 353 -1395 98 -126 161 -189 223 -222 48 -24 65 -28
144 -28 107 0 163 22 233 93 67 66 87 119 87 227 0 107 -19 151 -110 255 -125
141 -220 317 -265 486 -138 529 114 1088 602 1335 432 218 940 150 1308 -176
95 -84 155 -110 255 -110 95 0 165 28 229 90 62 62 91 134 91 230 0 140 -48
210 -250 367 -269 209 -589 334 -940 368 -104 9 -227 11 -305 3z"/>
<path d="M1053 6383 c-57 -20 -138 -94 -171 -157 -24 -45 -27 -62 -27 -146 0
-84 3 -101 27 -146 15 -28 50 -72 78 -97 82 -73 101 -77 426 -77 332 0 358 5
444 90 159 160 102 452 -105 529 -52 20 -75 21 -343 20 -228 0 -296 -4 -329
-16z"/>
<path d="M7004 5536 c-180 -91 -232 -242 -164 -477 38 -132 57 -236 71 -380
13 -141 13 -121 0 -264 -17 -186 -69 -411 -122 -530 -24 -54 -132 -249 -163
-295 -86 -128 -262 -313 -360 -380 -27 -18 -57 -41 -66 -50 -24 -24 -128 -86
-196 -117 -33 -14 -62 -30 -65 -35 -8 -13 -193 -77 -284 -98 -44 -11 -125 -26
-181 -34 -169 -26 -280 -101 -329 -223 -47 -119 -31 -238 54 -376 22 -37 41
-70 41 -73 0 -3 18 -26 40 -51 22 -25 53 -66 69 -90 36 -54 191 -216 287 -300
193 -168 511 -346 744 -416 235 -71 414 -97 668 -97 194 0 312 13 487 50 106
23 335 95 345 108 3 4 34 20 70 36 78 34 233 115 240 126 3 5 46 35 96 68 164
107 375 314 505 492 30 41 61 87 68 102 8 15 23 37 33 48 20 22 117 211 139
273 7 20 16 37 20 37 9 0 73 204 98 310 59 253 74 586 38 820 -31 200 -96 449
-132 505 -6 11 -38 76 -70 145 -31 69 -69 141 -84 160 -16 19 -35 49 -44 66
-9 17 -42 66 -75 110 -133 178 -331 368 -497 479 -49 33 -97 66 -105 74 -8 8
-76 44 -150 80 -74 36 -137 68 -140 72 -8 10 -182 67 -289 94 -152 39 -267 57
-401 62 l-125 5 -71 -36z m724 -843 c51 -25 110 -59 132 -77 21 -17 64 -49 96
-71 131 -92 301 -294 380 -452 27 -54 52 -100 56 -103 14 -11 78 -218 93 -305
25 -142 30 -331 11 -470 -21 -157 -82 -376 -111 -397 -7 -5 -7 -8 0 -8 6 0 5
-4 -2 -8 -6 -4 -30 -45 -52 -92 -68 -141 -235 -344 -365 -442 -39 -29 -78 -60
-87 -69 -23 -23 -130 -82 -209 -115 -36 -16 -67 -31 -70 -35 -10 -14 -208 -69
-305 -85 -135 -22 -362 -22 -479 0 -92 18 -254 68 -265 83 -3 4 -44 27 -91 50
-97 47 -131 69 -264 171 -88 67 -107 92 -71 92 7 0 15 3 17 8 2 4 61 34 133
67 71 33 143 70 160 81 16 12 75 50 129 85 55 34 107 69 115 78 9 9 51 45 94
80 146 118 315 300 412 441 112 162 126 185 172 280 25 52 50 98 57 102 6 4 7
8 1 8 -6 0 -6 3 0 8 22 15 103 254 141 412 20 82 20 82 27 100 28 70 47 442
28 542 -7 35 -15 71 -18 81 -7 25 13 19 135 -40z"/>
<path d="M2277 4590 c-81 -21 -125 -55 -313 -244 -227 -228 -239 -246 -239
-381 0 -71 5 -100 21 -136 31 -67 87 -124 152 -156 50 -24 69 -28 147 -28 133
0 159 17 387 244 222 221 242 253 243 386 0 67 -4 89 -28 136 -32 66 -100 132
-162 160 -52 23 -154 32 -208 19z"/>
</g>
</svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label=""  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 12a4 4 0 1 1 0-8 4 4 0 0 1 0 8m0-1.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m5.657-8.157a.75.75 0 0 1 0 1.061l-1.061 1.06a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.06-1.06a.75.75 0 0 1 1.06 0Zm-9.193 9.193a.75.75 0 0 1 0 1.06l-1.06 1.061a.75.75 0 1 1-1.061-1.06l1.06-1.061a.75.75 0 0 1 1.061 0M8 0a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 8 0M3 8a.75.75 0 0 1-.75.75H.75a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 3 8m13 0a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 16 8m-8 5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 8 13m3.536-1.464a.75.75 0 0 1 1.06 0l1.061 1.06a.75.75 0 0 1-1.06 1.061l-1.061-1.06a.75.75 0 0 1 0-1.061M2.343 2.343a.75.75 0 0 1 1.061 0l1.06 1.061a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-1.06-1.06a.75.75 0 0 1 0-1.06Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label=""  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.598 1.591a.75.75 0 0 1 .785-.175 7.001 7.001 0 1 1-8.967 8.967.75.75 0 0 1 .961-.96 5.5 5.5 0 0 0 7.046-7.046.75.75 0 0 1 .175-.786m1.616 1.945a7 7 0 0 1-7.678 7.678 5.499 5.499 0 1 0 7.678-7.678"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/VictorWang712/Note/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    VictorWang712/Note
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../mathematics/mathematical_analysis_I/" class="md-tabs__link">
          
  
  
    
  
  Mathematics

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../physics/general_physics_I/" class="md-tabs__link">
          
  
  
    
  
  Physics

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../chemistry/general_chemistry/" class="md-tabs__link">
          
  
  
    
  
  Chemistry

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../programming_and_algorithm_basics/" class="md-tabs__link">
          
  
  
    
  
  Computer Science

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../science_research/papers/arXiv_2306_13063/" class="md-tabs__link">
          
  
  
    
  
  Science Research

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../others/OPP/" class="md-tabs__link">
          
  
  
    
  
  Others

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Walker_V&#39;s Notebook" class="md-nav__button md-logo" aria-label="Walker_V's Notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 2h-5v8l-2.5-2.25L8 12V4H6v16h12z"/></svg>

    </a>
    Walker_V's Notebook
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/VictorWang712/Note/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    VictorWang712/Note
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../friends_links/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    友链
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Mathematics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Mathematics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/mathematical_analysis_I/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数学分析（甲）I (H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/mathematical_analysis_II/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数学分析（甲）II (H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../mathematics/discrete_mathematics/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    离散数学
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    离散数学
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/discrete_mathematics/chapter_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第一章 - 基础：逻辑和证明
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/discrete_mathematics/chapter_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第二章 - 基本结构：集合、函数、序列、求和与矩阵
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/discrete_mathematics/chapter_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第三章 - 算法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/discrete_mathematics/chapter_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第四章 - 归纳与递归
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/discrete_mathematics/chapter_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第五章 - 计数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/discrete_mathematics/chapter_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第六章 - 高级计数技术
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/discrete_mathematics/chapter_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第七章 - 关系
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/discrete_mathematics/chapter_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第八章 - 图
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../mathematics/probability_and_statistics/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    概率论与数理统计
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    概率论与数理统计
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/probability_and_statistics/chapter_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第一章 - 概率论的基本概念
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/probability_and_statistics/chapter_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第二章 - 随机变量及其概率分布
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/probability_and_statistics/chapter_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第三章 - 多维随机变量及其分布
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/probability_and_statistics/chapter_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第四章 - 随机变量的数字特征
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/probability_and_statistics/chapter_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第五章 - 大数定律及中心极限定理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/probability_and_statistics/chapter_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第六章 - 统计量与抽样分布
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/probability_and_statistics/chapter_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第七章 - 参数估计
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mathematics/probability_and_statistics/chapter_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第八章 - 假设检验
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Physics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Physics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../physics/general_physics_I/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    普通物理学 I (H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Chemistry
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Chemistry
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chemistry/general_chemistry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    普通化学 (H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Computer Science
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Computer Science
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming_and_algorithm_basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    程序设计与算法基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../digital_logic_design/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    数字逻辑设计
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    数字逻辑设计
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../digital_logic_design/chapter_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第一章 - 数字系统和信息
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../digital_logic_design/chapter_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第二章 - 组合逻辑电路
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../digital_logic_design/chapter_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第三章 - 组合逻辑电路的设计
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../digital_logic_design/chapter_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第四章 - 时序电路
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../digital_logic_design/chapter_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第五章 - 数字硬件实现
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../digital_logic_design/chapter_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第六章 - 寄存器与寄存器传输
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../digital_logic_design/chapter_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第七章 - 存储器基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    计算机组成
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    计算机组成
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第一章 - 计算机概要与技术
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第二章 - 指令
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第三章 - 计算机的算术运算
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    第四章 - 处理器
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    第四章 - 处理器
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#risc-v" class="md-nav__link">
    <span class="md-ellipsis">
      
        一种基本的 RISC-V 实现
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        逻辑设计的一般方法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="逻辑设计的一般方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        时钟同步方法
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        建立数据通路
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建立数据通路">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        各指令所需的数据通路单元
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        建立一个简单的数据通路
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        一个简单的实现方案
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一个简单的实现方案">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alu" class="md-nav__link">
    <span class="md-ellipsis">
      
        ALU 控制
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        设计主控制单元
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        数据通路操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        控制的结束
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        为什么现在不使用单周期实现
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线概述
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流水线概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        面向流水线的指令系统
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线冒险
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流水线冒险">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        结构冒险
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        数据冒险
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        控制冒险
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        小结
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线数据通路和控制
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流水线数据通路和控制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线的图形化表示
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线控制
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
        数据冒险的处理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数据冒险的处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      
        前递
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
        停顿
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      
        控制冒险的处理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="控制冒险的处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      
        假设分支不发生
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      
        缩短分支延迟
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      
        动态分支预测
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      
        例外
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="例外">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#risc-v_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        RISC-V 中如何处理例外
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线实现中的例外
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      
        指令间的并行性
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="指令间的并行性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      
        推测
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态多发射
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      
        动态多发射
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第五章 - 层次化存储
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第六章 - 存储、网络和其它外部设备
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../data_structure_basics/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    数据结构基础
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    数据结构基础
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_structure_basics/chapter_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第一章 - 算法分析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_structure_basics/chapter_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第二章 - 表、栈和队列
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_structure_basics/chapter_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第三章 - 树
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_structure_basics/chapter_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第四章 - 优先队列（堆）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_structure_basics/chapter_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第五章 - 不相交集 ADT
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_structure_basics/chapter_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第六章 - 图论算法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_structure_basics/chapter_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第七章 - 排序
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_structure_basics/chapter_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第八章 - 散列
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_structure_basics/mistakes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    错题整理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../advanced_data_structure/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    高级数据结构与算法分析
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    高级数据结构与算法分析
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第一章 - 高级数据结构
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第二章 - 倒排索引
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第三章 - 优先队列（堆）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第四章 - 回溯算法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第五章 - 分治算法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第六章 - 动态规划
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第七章 - 贪心
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第八章 - NP-完全性
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第九章 - 近似算法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第十章 - 局部搜索
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第十一章 - 随机算法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第十二章 - 并行算法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/chapter_13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第十三章 - 外部排序
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_data_structure/tips/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    知识整理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../static_program_analysis/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    静态程序分析*
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    静态程序分析*
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../static_program_analysis/chapter_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第一章 - 引言
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../static_program_analysis/chapter_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第二章 - 中间语言
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../agentic_ai/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    代理式人工智能*
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    代理式人工智能*
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agentic_ai/chapter_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    模块 1: Agentic 工作流简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Science Research
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Science Research
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    论文阅读
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    论文阅读
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science_research/papers/arXiv_2306_13063/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [ICLR] Can LLMs Express Their Uncertainty? An Empirical Evaluation of Confidence Elicitation in LLMs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science_research/papers/arXiv_2405_12641/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [TSE] Fight Fire with Fire: How Much Can We Trust ChatGPT on Source Code-Related Tasks?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science_research/papers/arXiv_2404_19318/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [arXiv] Enhancing Trust in LLM-Generated Code Summaries with Calibrated Confidence Scores
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science_research/papers/arXiv_2306_00108/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [ASE] Better patching using LLM prompting, via Self-Consistency
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science_research/papers/arXiv_2402_02047/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [ICSE] Calibration and Correctness of Language Models for Code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science_research/papers/arXiv_2403_16437/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [ICSE] Reasoning Runtime Behavior of a Program with LLM: How Far Are We?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science_research/papers/arXiv_2404_14662/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [ICML] NExT: Teaching Large Language Models to Reason about Code Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science_research/papers/arXiv_2503_04149/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [arXiv] Dynamic Benchmarking of Reasoning Capabilities in Code Large Language Models Under Data Contamination
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science_research/papers/arXiv_1511_06279/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [ICLR] Neural Programmer-Interpreters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science_research/papers/arXiv_1611_01989/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [ICLR] DeepCoder: Learning to Write Programs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science_research/papers/arXiv_2504_01943/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [arXiv] OpenCodeReasoning: Advancing Data Distillation for Competitive Coding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Others
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Others
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../others/OPP/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Oxford Prospects Programmes '25 Winter
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Oxford Prospects Programmes '25 Winter
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome Lecture - Introduction to Oxford University
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/workshop_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workshop 1 - Academic Presentation Skills
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 2 - AI-Driven Innovation: Shaping the Future of Energy System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 3 - Particle Accelerators: From Producing Higgs Boson to Curing Cancer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 4 - Geometric Deep Learning: Part 1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/workshop_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workshop 2 - British Culture and Etiquette
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 5 - Writing Computer Programmes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 6 - Multicomponent High-Entropy Cantor Alloys
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 7 - Artificial Intelligence for Decision-Making and Robotics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 8 - The Probabilistic Method
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/workshop_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workshop 3 - Film Production
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/workshop_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workshop 4 - Critical Thinking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 9 - Engineering Science: Air Pollution from Vehicles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 10 - Ethics and Artificial Intelligence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 11 - Applications of Particle Accelerators
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 12 - Water Resources, Rights, and Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 13 - Weighing the Invisible
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/workshop_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workshop 5 - Student Panel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/workshop_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workshop 6 - Postgraduate Studies Workshop
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/workshop_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workshop 7 - Public Speaking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 14 - Fluid Mechanics for Offshore Renewable Energy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 15 - Social Networks from Math to Measurement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Special Guest Lecture - Downton Abbey
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 17 - Geometric Deep Learning: Part 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 18 - The Age of (Healthcare) Big Data: Past, Present, Future
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 19 - The Changing Faces of Deepfakes and Generative AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 20 - Battery Modelling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/OPP/lecture_21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lecture 21 - The Next Generation of Nuclear Power
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#risc-v" class="md-nav__link">
    <span class="md-ellipsis">
      
        一种基本的 RISC-V 实现
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        逻辑设计的一般方法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="逻辑设计的一般方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        时钟同步方法
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        建立数据通路
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建立数据通路">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        各指令所需的数据通路单元
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        建立一个简单的数据通路
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        一个简单的实现方案
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一个简单的实现方案">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alu" class="md-nav__link">
    <span class="md-ellipsis">
      
        ALU 控制
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        设计主控制单元
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        数据通路操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        控制的结束
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        为什么现在不使用单周期实现
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线概述
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流水线概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        面向流水线的指令系统
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线冒险
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流水线冒险">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        结构冒险
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        数据冒险
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        控制冒险
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        小结
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线数据通路和控制
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流水线数据通路和控制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线的图形化表示
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线控制
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
        数据冒险的处理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数据冒险的处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      
        前递
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
        停顿
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      
        控制冒险的处理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="控制冒险的处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      
        假设分支不发生
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      
        缩短分支延迟
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      
        动态分支预测
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      
        例外
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="例外">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#risc-v_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        RISC-V 中如何处理例外
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      
        流水线实现中的例外
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      
        指令间的并行性
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="指令间的并行性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      
        推测
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态多发射
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      
        动态多发射
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="-">第四章 - 处理器</h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 11261 个字 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 40 行代码 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 38 分钟</p>
</div>
<p>本章将概括地介绍实现处理器所要用到的原理和技术。首先从一个高度抽象和简化的概述开始，之后以此为基础为 RISC-V 指令系统构建数据通路，并设计一种简单的、能够实现指令系统的处理器。之后，我们将探讨更接近实际情况的流水线 RISC-V。</p>
<h2 id="risc-v">一种基本的 RISC-V 实现</h2>
<p>我们将实现 RISC-V 的一个核心子集：</p>
<ul>
<li>存储器访问指令 load doubleword (<code>ld</code>) 和 store doubleword (<code>sd</code>)</li>
<li>算术逻辑指令 <code>add</code>、<code>sub</code>、<code>and</code> 和 <code>or</code></li>
<li>条件分支指令 branch if equal (<code>beq</code>)</li>
</ul>
<p>这个子集说明了简历数据通路和设计控制的关键原理，其余指令的实现也与这个子集类似。</p>
<p>对于这三类指令，其实现每条指令的前几个步骤是类似的：</p>
<ol>
<li>程序计数器（PC）发送到指令所在的存储单元，并从中取出指令。</li>
<li>根据指令的某些字段选择要读取的 1 个或 2 个寄存器。</li>
<li>使用算术逻辑单元（ALU）：存储器访问指令用 ALU 进行地址计算，算术逻辑指令用 ALU 执行运算，条件分支指令用 ALU 进行比较。</li>
</ol>
<p>但在经过 ALU 后，完成各类指令所需的操作就不同了。存储器访问指令需要访问存储器以读取数据或存储数据，算术逻辑指令或载入指令需要将来自 ALU 或存储器的数据写回寄存器，条件分支指令需要很具比较结果更改下一条指令的地址（否则下一条指令的地址通过 PC 加 <span class="arithmatex">\(4\)</span> 来获得）。</p>
<p>在这个过程中，许多地方会存在两个来自不同源的数据流向同一个单元。此时就涉及到数据的选择，我们使用<strong>多选器</strong> (multiplexor)，或称<strong>数据选择器</strong> (data selector) 来完成。此外，一些功能单元的控制依赖于当前执行的指令类型。因此我们还需要引入<strong>控制单元</strong> (functional unit) 来确定如何设置控制线。</p>
<p>基于以上分析，我们可以得到这样的一个抽象的实现图：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_1.png" width="70%" style="margin: 0 auto;">
</div>

<p>在后续内容中，我们将基于这个实现图继续改进并补充细节，并通过添加时序控制使得处理器可以有序运行指令。</p>
<h2 id="_1">逻辑设计的一般方法</h2>
<p>RISC-V 实现中的数据通路包含两种不同类型的逻辑单元：处理数据值的单元和存储状态的单元。处理数据值的单元是<strong>组合逻辑</strong> (combinational logic)，它们的输出仅依赖于当前输入。设计中的其它单元不是组合逻辑，而是包含<strong>状态</strong> (state) 的。如果一个单元有内部存储功能，它就包含状态，称其为<strong>状态单元</strong> (state elements)。这些逻辑部件也被称作<strong>时序</strong> (sequential) 的，因为其输出取决于输入和内部状态。</p>
<h3 id="_2">时钟同步方法</h3>
<p><strong>时钟同步方法</strong> (clocking methodology) 规定了信号可以读出和写入的时间。为简单起见，假定我们采用<strong>边沿触发的时钟</strong> (edge-triggered clocking)，即存储在时序逻辑单元中的所有值仅在时钟边沿更新。如果状态单元在每个有效时钟边沿都进行写入，则可忽略写<strong>控制信号</strong> (control signal)。更进一步地，我们规定仅在时钟上升沿写入。</p>
<p>我们将用术语<strong>有效</strong> (asserted) 表示信号为逻辑高，用<strong>使有效</strong> (assert) 表示信号应为逻辑高，用<strong>无效</strong> (deasserted) 或<strong>使无效</strong> (deassert) 表示信号为逻辑低。</p>
<details class="note" open="open">
<summary>Note</summary>
<p>这样规定是因为在进行硬件实现时，数字 <span class="arithmatex">\(1\)</span> 有时表示逻辑高，又是表示逻辑低。</p>
</details>
<h2 id="_3">建立数据通路</h2>
<p>设计数据通路的合理方法是，先分析每类 RISC-V 指令需要哪些主要执行单元。本节首先讨论每条指令需要哪些<strong>数据通路单元</strong> (datapath element)，然后逐渐降低抽象的层次。在设计数据通路单元的同时，也会设计它们的控制信号。</p>
<h3 id="_4">各指令所需的数据通路单元</h3>
<p>下图是三个核心的单元：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_2.png" width="70%" style="margin: 0 auto;">
</div>

<p>首先是存储单元，用于存储程序的指令，并根据给定地址提供指令。然后是程序计数器（PC），用于保存当前指令的地址。最后还需要一个加法器来增加 PC 的值以获得下一条指令的地址，在实际情况中，这一单元通常使用 ALU，并将控制信号常设为加法来实现。</p>
<p>要执行任意一条指令，首先要从存储器中取出指令。为准备执行下一条指令，必须增加程序计数器的值，使其指向下一条指令。这一操作的数据通路如下图：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_3.png" width="70%" style="margin: 0 auto;">
</div>

<p>现在考虑 R 型指令或算术逻辑指令。这类指令读两个寄存器，对它们的内容执行 ALU 操作，再将结果写回寄存器。这些指令包括 <code>add</code>、<code>sub</code>、<code>and</code> 和 <code>or</code> 指令。</p>
<p>处理器的 32 个通用寄存器位于结构<strong>寄存器堆</strong> (register file) 中。寄存器堆是寄存器的集合，其中的寄存器可以通过指定相应的寄存器号来进行读写。寄存器堆包含了计算机的寄存器状态。另外，还需要一个 ALU 对从寄存器读出的值进行运算。</p>
<p>由于 R 型指令有 3 个寄存器操作数，每条指令需要从寄存器堆中读出两个数据字，再写入一个数据字。为读出一个数据字，需要一个输入指定要读的存储器号，以及一个从寄存器堆读出的输出。为写入一个数据字，寄存器堆需要两个输入，一个输入指定要写的寄存器号，另一个提供要写入寄存器的数据。其对应的硬件单元如下图：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_4.png" width="70%" style="margin: 0 auto;">
</div>

<p>下面考虑 RISC-V 的存取指令，其一般形式为 <code>ld x1, offset(x2)</code> 和 <code>sd x1, offset(x2)</code>。这类指令通过将基址寄存器 <code>x2</code> 与指令中包含的 12 位有符号偏移量相加，得到存储器地址。对于存储指令，从寄存器 <code>x1</code> 中读出要存储的数据；如果是载入指令，那么从存储器中读出的数据要写入指定的寄存器 <code>x1</code> 中。</p>
<p>因此为实现存取指令，除了前述的寄存器堆和 ALU 外，还需要一个单元将指令中的 12 位偏移量<strong>符号扩展</strong> (sign-extend) 为 64 位有符号数，以及一个执行读写操作的数据存储单元。数据存储单元在存储指令时被写入，所以它有读写控制信号、地址输入和写入存储器的数据输入。下图给出了这两个单元：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_5.png" width="70%" style="margin: 0 auto;">
</div>

<p><code>beq</code> 指令有 3 个操作数，其中两个寄存器用于比较是否相等，另一个是 12 位偏移量，用于计算相对于分支指令所在地址的<strong>分支目标地址</strong> (branch target address)。其指令格式是 <code>beq x1, x2, offset</code>。为实现 <code>beq</code> 指令，需将 PC 值与符号扩展后的指令偏移量相加以得到分支目标地址。</p>
<details class="note" open="open">
<summary>Note</summary>
<p>这里我们再次提醒，基于第二章中分支指令的定义，有 2 个必须注意的细节：</p>
<ul>
<li>指令系统体系结构规定了计算分支目标地址的基址是分支指令所在地址。</li>
<li>指令系统体系结构还说明了计算分支目标地址时，将偏移量左移 <span class="arithmatex">\(1\)</span> 位以表示半字为单位的偏移量，这样偏移量的有效范围就扩大到 <span class="arithmatex">\(2\)</span> 倍。</li>
</ul>
</details>
<p>在计算分支目标地址的同时，必须确定是顺序执行下一条指令，还是执行分支目标地址处的指令。当分支条件为真时，分支目标地址成为新的 PC，我们就称<strong>分支发生</strong> (branch is taken)。如果条件不成立，如果条件不成立，自增后的 PC 成为新的 PC，此时就称<strong>分支未发生</strong> (branch is not taken)。</p>
<p>因此，分支指令的数据通路需要执行两个操作：计算分支目标地址和检测分支条件。下图即为分支指令的数据通路：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_6.png" width="70%" style="margin: 0 auto;">
</div>

<h3 id="_5">建立一个简单的数据通路</h3>
<p>我们已经分别讨论了几类指令需要的数据通路单元，现在可将它们组合成一个完整的数据通路并添加控制信号以完成实现。</p>
<p>这个最简单的数据通路在每个时钟周期执行一条指令。这意味着每条指令在执行过程中的任何数据通路单元都只能使用一次，如果需要多次使用某数据通路单元，则要将其复制多份。因此，需要一个指令存储器和一个与之分开的数据存储器。尽管还有一些功能单元需要多份，但很多功能单元可以在不同的指令流动中被共享。</p>
<p>为在两个不同类指令之间共享数据通路单元，需要允许一个单元有多个输入，我们用多路选择器和控制信号在多个输入中进行选择。</p>
<p>于是，我们可以构造存储类指令和 R 型指令的数据通路，如下图：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_7.png" width="70%" style="margin: 0 auto;">
</div>

<p>最后，我们将前述的取指令数据通路、R 型指令和存储类指令数据通路、分支指令数据通路合并，就可以得到 RISC-V 指令系统核心集的一个简单数据通路，如下图：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_8.png" width="70%" style="margin: 0 auto;">
</div>

<h2 id="_6">一个简单的实现方案</h2>
<p>现在我们已经有了这个简单处理器的数据通路，我们将基于此并增加一个简单的控制单元来实现。</p>
<h3 id="alu">ALU 控制</h3>
<p>ALU 的控制是容易的，我们先明确其所有的控制信号：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_9.png" width="70%" style="margin: 0 auto;">
</div>

<p>据此，我们可以采用多级译码的方式，得到控制信号的真值表：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_10.png" width="70%" style="margin: 0 auto;">
</div>

<h3 id="_7">设计主控制单元</h3>
<p>现在我们考虑控制的其他部分。对于主控制单元，其需要处理不同的指令，因此要能够有效「解读」指令。所以首先，我们先来回顾四类指令的格式：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_11.png" width="70%" style="margin: 0 auto;">
</div>

<p>经过一些整理，我们可以引入 6 个控制信号：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_12.png" width="70%" style="margin: 0 auto;">
</div>

<p>设置这些控制信号的对应的真值表如下：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_13.png" width="70%" style="margin: 0 auto;">
</div>

<p>于是，在我们引入了这些控制信号后，就可以得到带有控制单元的简单数据通路：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_14.png" width="70%" style="margin: 0 auto;">
</div>

<h3 id="_8">数据通路操作</h3>
<p>根据前述的数据通路，我们可以设计控制单元的逻辑。但在此之前，我们可以先明确，各类指令是如何使用数据通路的。</p>
<p>R 型指令的执行可以分为 4 个步骤：</p>
<ol>
<li>取出指令，PC 自增。</li>
<li>从寄存器堆读出两个寄存器 <code>x2</code> 和 <code>x3</code>，同时主控制单元在此步骤计算控制信号。</li>
<li>根据部分操作码确定 ALU 的功能，对从寄存器堆读出的数据进行操作。</li>
<li>将 ALU 的结果写入寄存器堆中的目标寄存器 <code>x1</code>。</li>
</ol>
<p>load 指令的执行可以分为 5 个步骤：</p>
<ol>
<li>从指令存储器中取出指令，PC 自增。</li>
<li>从寄存器堆读出寄存器 <code>x2</code> 的值。</li>
<li>ALU 将从寄存器堆中读出的值和符号扩展后的指令中的 12 位（偏移量）相加。</li>
<li>将 ALU 的结果用作数据存储器的地址。</li>
<li>将从存储器读出的数据写入寄存器堆 <code>x1</code>。</li>
</ol>
<p>branch-if-equal 指令的执行可以分为 4 个步骤：</p>
<ol>
<li>从指令存储器中取出指令，PC 自增。</li>
<li>从寄存器堆中读出两个寄存器 <code>x1</code> 和 <code>x2</code>。</li>
<li>ALU 将从寄存器堆读出的两数相减。PC 与左移一位、符号扩展的指令中的 12 位（偏移量）相加，结果是分支目标地址。</li>
<li>ALU 的零输出决定将哪个加法器的结果写入 PC。</li>
</ol>
<h3 id="_9">控制的结束</h3>
<p>我们已经了解了指令如何按步骤操作，现在继续讨论控制单元的实现。控制单元的功能可以根据控制信号精确定义，其输出是控制线，输入是操作码。因此，可以根据操作码的二进制编码为每个输出建立一个真值表，如下：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_15.png" width="70%" style="margin: 0 auto;">
</div>

<h3 id="_10">为什么现在不使用单周期实现</h3>
<p>截至目前，我们已经实现了一个单周期的 RISC-V 核心集处理器。因此在进入后文对流水线处理器的探讨前，我们来简单讨论一下单周期处理器的一些问题。</p>
<p>尽管单周期设计可以正确工作，但是在现代设计中不采取这种方式，因为它的效率太低。究其原因，是在单周期设计中时钟周期对于每条指令必须等长。这样，处理器中的最长路径决定了时钟周期。这样即使 CPI 为 <span class="arithmatex">\(1\)</span>，但单个时钟周期太长，实现的整体性能可能很差。</p>
<details class="note" open="open">
<summary>Note</summary>
<p>在多数时候，这条最长路径很可能是一条 load 指令，它连续地使用 5 个功能单元：指令存储器、寄存器堆、ALU、数据存储器和寄存器堆。</p>
</details>
<p>使用单周期设计的代价是显著的，但对于小指令集而言，或许是可以接受的。历史上，早期具有简单指令集的计算机确实采用这种实现方式。但是，如果要实现浮点单元或更复杂的指令集，单周期设计根本无法正常工作。</p>
<h2 id="_11">流水线概述</h2>
<h3 id="_12">面向流水线的指令系统</h3>
<p><strong>流水线</strong> (pipelining) 是一种能使多条指令重叠执行的实现技术。流水线的概念是朴素的，其核心在于，流水线中每个步骤的时间并没有缩短，但流水线通过并行地执行各个步骤，提高了系统的<strong>吞吐率</strong> (throughput)，从而能够在单位时间内完成更多的工作。</p>
<p>这一原则同样可以用于处理器，即采用流水线方式执行指令。RISC-V 指令执行通常包含 5 个步骤：</p>
<ol>
<li>取指（IF）：从存储器中取出指令。</li>
<li>译码（ID）：读寄存器并译码指令。</li>
<li>执行（EX）：执行操作或计算地址。</li>
<li>访存（MEM）：访问数据存储器中的操作数（如有必要）。</li>
<li>写回（WB）：将结果写入寄存器（如有必要）。</li>
</ol>
<p>因此，接下来要探讨的 RISC-V 流水线有 5 个阶段。为了使讨论具体化，我们先建立一个流水线。之后我们考虑的是这 7 条指令：<code>ld</code>、<code>sd</code>、<code>add</code>、<code>sub</code>、<code>and</code>、<code>or</code>、<code>beq</code>。</p>
<p>我们先来给出这些指令在各功能单元的处理时间：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_16.png" width="70%" style="margin: 0 auto;">
</div>

<p>基于这些数据，我们先给出一个执行指令的示例，以直观地感受非流水线和流水线执行的区别：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_17.png" width="70%" style="margin: 0 auto;">
</div>

<p>可见，尽管在每个功能单元执行的每一步时间没有减少，但是指令的平均执行时间却从 <span class="arithmatex">\(800 \mathrm{ps}\)</span> 降低到了 <span class="arithmatex">\(200 \mathrm{ps}\)</span>，即提供了 <span class="arithmatex">\(4\)</span> 倍的性能改进。</p>
<p>我们可以将这种性能加速比归纳为一个公式。如果流水线各阶段操作平巷，那么在理想条件下，流水线处理器上的指令执行时间满足</p>
<div class="arithmatex">\[\text{指令执行时间}_{\text{流水线}} = \frac{\text{指令执行时间}_{\text{非流水线}}}{\text{流水线级数}}\]</div>
<p>也就是说，在理想的条件和有大量指令的情况下，流水线带来的加速比约等于流水线级数。</p>
<p>流水线技术通过提高指令吞吐率来提高性能，而不是减少单个指令的执行时间。因此指令吞吐率是评估流水线性能的重要指标。</p>
<h3 id="_13">流水线冒险</h3>
<p>那么我们现在就开始考虑真正的流水线设计中可能遇到的问题。一个容易想到的情况就是，在下一个时钟周期中下一条指令无法执行。这种情况被称作<strong>冒险</strong> (hazard)，具体来说有三种情况。</p>
<h4 id="_14">结构冒险</h4>
<p>第一种冒险称作<strong>结构冒险</strong> (structural hazard)，即硬件不支持多条指令在同一时钟周期执行。</p>
<p>当然，RISC-V 指令系统是面向流水线设计的，这使得设计人员在多数情况下容易避免结构冒险。唯一可能面对的情况是，硬件的数量有限导致对同一硬件的复用。但总的来说是容易处理的。</p>
<h4 id="_15">数据冒险</h4>
<p>第二种冒险称作<strong>数据冒险</strong> (data hazard)，即由于一个步骤必须等待另一个步骤完成而导致的流水线停顿。</p>
<p>在计算机流水线中，数据冒险源于一条指令依赖于前面一条尚在流水线中的指令。在不做任何干预的情况下，数据冒险通常会严重地阻碍流水线。</p>
<p>一种基本的解决方案是基于一个发现，即不需要等待指令完成就可以尝试解决数据冒险。这通过向内部资源添加额外的硬件，以提前从缓冲区中取到后一步需要的数据，而不是等到前一个指令执行完毕，数据到达程序员可见的寄存器或存储器。这种方法称作<strong>前递</strong> (forwarding) 或<strong>旁路</strong> (bypassing)。</p>
<blockquote>
<p>我们来看这样一个例子，对于以下两条指令：</p>
<div class="highlight"><pre><span></span><code><span class="nf">add</span><span class="w"> </span><span class="no">x1</span><span class="p">,</span><span class="w"> </span><span class="no">x2</span><span class="p">,</span><span class="w"> </span><span class="no">x3</span>
<span class="nf">sub</span><span class="w"> </span><span class="no">x4</span><span class="p">,</span><span class="w"> </span><span class="no">x1</span><span class="p">,</span><span class="w"> </span><span class="no">x5</span>
</code></pre></div>
<p>我们如下图这样来构造流水线：</p>
<p><div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_18.png" width="70%" style="margin: 0 auto;">
</div></p>
<p>即将 <code>add</code> 指令 EX 阶段的输出前递到 <code>sub</code> 指令 EX 阶段的输入，替换 <code>sub</code> 指令在第二阶段读出的寄存器 <code>x1</code> 的值。</p>
</blockquote>
<p>当然，尽管前递的效果很好，但是不能避免所有的流水线停顿，仅当目标阶段在时间上晚于源阶段时，前递路径才有效。这种问题通常出现在<strong>载入-使用型数据冒险</strong> (load-use data hazard) 中，对应于我们考察的指令就是在后一条指令中使用了前一条 <code>ld</code> 指令的载入值。因此，这种情况下流水线也不得不停顿一个阶段来应对，如下图：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_19.png" width="70%" style="margin: 0 auto;">
</div>

<p>这张图中包含了流水线的一个重要概念，即<strong>流水线停顿</strong> (pipeline stall)，也通常称作<strong>气泡</strong> (bubble)。在之后的章节我们会详细介绍如何解决这类冒险。</p>
<h4 id="_16">控制冒险</h4>
<p>第三种冒险称作<strong>控制冒险</strong> (control hazard)，即一个步骤如何执行需要根据另一个步骤的执行结果，而那个步骤还未执行完毕。</p>
<p>容易意识到，这种问题主要出现在条件分支指令的处理上。解决这类冒险的主要方法是<strong>预测</strong> (prediction)，即假设一个预期结果，并按照预期结果先行流水线执行之后的步骤。如果实际的执行结果和预期不同，再重新开始执行对应的后续步骤。这样，处理器就仅在预期结果不正确的时候，才会发生停顿。</p>
<p>显然，这个方法的有效性取决于预测的正确性。在当下，成熟的分支预测可以预测一些条件分支指令发生跳转，而另一些不发生跳转。更进一步地，动态硬件预测其可以根据每个条件分支指令的行为进行预测，并在程序生命周期内可能改变条件分支的预测结果，并根据最近的成功预测调整下一次的预测。</p>
<p>这种动态预测的一种常用实现方法是保存每个条件分支是否发生分支的历史记录然后根据最近的过去行为来预测未来。在后面的章节我们将指出，当历史记录的数量和类型足够多时，动态分支预测器的正确率可以达到 <span class="arithmatex">\(90\%\)</span>。</p>
<h3 id="_17">小结</h3>
<p>流水线技术是一种在顺序指令流中开发指令间<strong>并行性</strong> (parallelism) 的技术。与多处理器编程相比，其优点在于它对程序员是不可见的。</p>
<p>在接下来，我们将开始详细地介绍，对于上述各种问题的具体技术处理方式。</p>
<h2 id="_18">流水线数据通路和控制</h2>
<h3 id="_19">流水线的图形化表示</h3>
<p>首先，我们给出两种流水线图。我们以下述指令为例进行说明：</p>
<div class="highlight"><pre><span></span><code><span class="nf">ld</span><span class="w"> </span><span class="no">x10</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">(</span><span class="no">x1</span><span class="p">)</span>
<span class="nf">sub</span><span class="w"> </span><span class="no">x11</span><span class="p">,</span><span class="w"> </span><span class="no">x2</span><span class="p">,</span><span class="w"> </span><span class="no">x3</span>
<span class="nf">add</span><span class="w"> </span><span class="no">x12</span><span class="p">,</span><span class="w"> </span><span class="no">x3</span><span class="p">,</span><span class="w"> </span><span class="no">x4</span>
<span class="nf">ld</span><span class="w"> </span><span class="no">x13</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span><span class="p">(</span><span class="no">x1</span><span class="p">)</span>
<span class="nf">add</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="no">x5</span><span class="p">,</span><span class="w"> </span><span class="no">x6</span>
</code></pre></div>
<p>第一种是<strong>多时钟周期流水线图</strong> (multiple-clock-cycle pipeline diagram)，如下：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_20.png" width="70%" style="margin: 0 auto;">
</div>

<p>其中，图形的左半边阴影表示写入，右半边阴影表示读取，全阴影表示两者皆有，无阴影表示实际上不经过该阶段。</p>
<p>第二种是<strong>单时钟周期流水线图</strong> (single-clock-cycle pipeline diagram)，下图是上述指令流程中第 5 个时钟周期的单时钟周期图：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_21.png" width="70%" style="margin: 0 auto;">
</div>

<h3 id="_20">流水线控制</h3>
<p>现在我们要将控制添加到流水线数据通路中，这一部分可以类比我们<a href="https://victorwang712.github.io/Note/computer_science/computer_organisation/chapter_4/#_7">在单周期处理器中的做法</a>。</p>
<p>第一步是在现有的数据通路上标记控制线，与单周期实现的情况一样，我们假定 PC 在每个时钟周期被写入，因此 PC 没有单独的写入信号。同理，流水线寄存器（IF/ID、ID/EX、EX/MEM 和 MEM/WB）也没有单独的写入信号，因为流水线寄存器也在每个时钟周期内都被写入。</p>
<p>为了详细说明流水线的控制，我们需要在每个流水现阶段上设置控制值。由于每条控制线都只与一个流水线阶段中的功能部件相关，因此我们可以根据流水线阶段将控制线也划分成 5 组：</p>
<ol>
<li>取指：读指令存储器和写 PC 的控制信号总是有效的，因此在这个阶段没有什么需要特别控制的内容。</li>
<li>指令译码 / 读寄存器堆：在 RISC-V 指令格式中两个源寄存器总是位于相同的位置，因此在这个阶段也没有什么需要特别控制的内容。</li>
<li>执行 / 地址计算：要设置的信号是 ALUOp 和 ALUSrc，这个信号选择 ALU 操作，并将读数据 2 或者符号扩展的立即数作为 ALU 的输入。</li>
<li>存储器访问：本阶段要设置的控制线是 Branch、MemRead 和 MemWrite。这些信号分别由相等则分支、加载和存储指令设置。除非控制电路标示这是一条分支指令并且 ALU 的输出为 <span class="arithmatex">\(0\)</span>，否则将选择线性地址的下一条指令作为 PCSrc 信号。</li>
<li>写回：两条控制线是 MemtoReg 和 RegWrite，MemtoReg 决定是将 ALU 结果还是将存储器值发送到寄存器堆中，RegWrite 写入所选值。</li>
</ol>
<p>下图显示了具有扩展流水线寄存器并且将控制线连接到相应流水线阶段的完整数据通路。</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_22.png" width="70%" style="margin: 0 auto;">
</div>

<h2 id="_21">数据冒险的处理</h2>
<h3 id="_22">前递</h3>
<p>前面我们已经指出，数据冒险是流水线执行的关键阻碍。本节我们将详细讨论处理数据冒险的方法。我们将基于下面这样一个指令序列的示例进行讨论：</p>
<div class="highlight"><pre><span></span><code><span class="nf">sub</span><span class="w"> </span><span class="no">x2</span><span class="p">,</span><span class="w"> </span><span class="no">x1</span><span class="p">,</span><span class="w"> </span><span class="no">x3</span><span class="w"> </span><span class="c1">// Register x2 written by sub</span>
<span class="nf">and</span><span class="w"> </span><span class="no">x12</span><span class="p">,</span><span class="w"> </span><span class="no">x2</span><span class="p">,</span><span class="w"> </span><span class="no">x5</span><span class="w"> </span><span class="c1">// 1st operand(x2) depends on sub</span>
<span class="nf">or</span><span class="w"> </span><span class="no">x13</span><span class="p">,</span><span class="w"> </span><span class="no">x6</span><span class="p">,</span><span class="w"> </span><span class="no">x2</span><span class="w"> </span><span class="c1">// 2nd operand(x2) depends on sub</span>
<span class="nf">add</span><span class="w"> </span><span class="no">x14</span><span class="p">,</span><span class="w"> </span><span class="no">x2</span><span class="p">,</span><span class="w"> </span><span class="no">x2</span><span class="w"> </span><span class="c1">// 1st(x2) &amp; 2nd(x2) depend on sub</span>
<span class="nf">sd</span><span class="w"> </span><span class="no">x15</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">(</span><span class="no">x2</span><span class="p">)</span><span class="w"> </span><span class="c1">// Base(x2) depends on sub</span>
</code></pre></div>
<p>后 4 条指令都相关于第一条指令中得到的存放在寄存器 <code>x2</code> 中的结果。这个指令序列是这样在流水线中运行的：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_23.png" width="70%" style="margin: 0 auto;">
</div>

<p>图中的连线表示了数据冒险具体发生的位置。通过分析寄存器间的时序关系，我们可以得到这样两对冒险的条件：</p>
<ol>
<li>(a) <span class="arithmatex">\(\texttt{EX/MEM.RegisterRd} = \texttt{ID/EX.RegisterRs1}\)</span> (b) <span class="arithmatex">\(\texttt{EX/MEM.RegisterRd} = \texttt{ID/EX.RegisterRs2}\)</span></li>
<li>(a) <span class="arithmatex">\(\texttt{MEM/WB.RegisterRd} = \texttt{ID/EX.RegisterRs1}\)</span> (b) <span class="arithmatex">\(\texttt{MEM/WB.RegisterRd} = \texttt{ID/EX.RegisterRs2}\)</span></li>
</ol>
<p>落实到示例中，可以发现 <code>sub</code> 和 <code>and</code> 指令之间存在类型为 1a 的冒险，<code>sub</code> 和 <code>or</code> 指令之间存在类型为 2b 的冒险。</p>
<p>但是，因为并不是所有的指令都会写回寄存器，所以在上述两对条件外，还要再加入额外的条件才能确定合适进行前递。首先，要检查 EX 和 MEM 阶段的 WB 控制字段以确定 RegWrite 信号，即 <code>EX/MEM.RegWrite</code> 和 <code>MEM/WB.RegWrite</code> 是否有效。其次，如果流水线中的指令以 <code>x0</code> 作为目标寄存器，我们希望避免前递非零的结果值。于是对应地，我们将 <span class="arithmatex">\(\texttt{EX/MEM.RegisterRd} \neq 0\)</span> 添加到第一类冒险条件，将 <span class="arithmatex">\(\texttt{MEM/WB.RegisterRd} \neq 0\)</span> 添加到第二类冒险条件，即可使得上述条件正常工作。</p>
<p>现在我们可以检测冒险了，我们来看一看得到的正确前递后的指令序列在流水线中的运行：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_24.png" width="70%" style="margin: 0 auto;">
</div>

<p>现在，我们给出通过前递解决冒险的数据通路：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_25.png" width="70%" style="margin: 0 auto;">
</div>

<p>其中多选器的控制值如下：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_26.png" width="70%" style="margin: 0 auto;">
</div>

<p>并且，我们可以给出检测冒险的条件以及解决相应冒险的控制信号：</p>
<ol>
<li>
<p>EX 冒险</p>
<div class="highlight"><pre><span></span><code><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegWrite</span>
<span class="nf">and</span><span class="w"> </span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegisterRd</span><span class="w"> </span><span class="p">!</span><span class="err">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="nf">and</span><span class="w"> </span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegisterRd</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">ID</span><span class="err">/</span><span class="no">EX.RegisterRs1</span><span class="p">))</span><span class="w"> </span><span class="no">ForwardA</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">10</span>

<span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegWrite</span>
<span class="nf">and</span><span class="w"> </span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegisterRd</span><span class="w"> </span><span class="p">!</span><span class="err">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="nf">and</span><span class="w"> </span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegisterRd</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">ID</span><span class="err">/</span><span class="no">EX.RegisterRs2</span><span class="p">))</span><span class="w"> </span><span class="no">ForwardB</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">10</span>
</code></pre></div>
</li>
<li>
<p>MEM 冒险</p>
<div class="highlight"><pre><span></span><code><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="no">MEM</span><span class="err">/</span><span class="no">WB.RegWrite</span>
<span class="nf">and</span><span class="w"> </span><span class="p">(</span><span class="no">MEM</span><span class="err">/</span><span class="no">WB.RegisterRd</span><span class="w"> </span><span class="p">!</span><span class="err">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="nf">and</span><span class="w"> </span><span class="no">not</span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegWrite</span><span class="w"> </span><span class="no">and</span><span class="w"> </span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegisterRd</span><span class="w"> </span><span class="p">!</span><span class="err">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="nf">and</span><span class="w"> </span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegisterRd</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">ID</span><span class="err">/</span><span class="no">EX.RegisterRs1</span><span class="p">))</span>
<span class="nf">and</span><span class="w"> </span><span class="p">(</span><span class="no">MEM</span><span class="err">/</span><span class="no">WB.RegisterRd</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">ID</span><span class="err">/</span><span class="no">EX.RegisterRs1</span><span class="p">))</span><span class="w"> </span><span class="no">ForwardA</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">01</span>

<span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="no">MEM</span><span class="err">/</span><span class="no">WB.RegWrite</span>
<span class="nf">and</span><span class="w"> </span><span class="p">(</span><span class="no">MEM</span><span class="err">/</span><span class="no">WB.RegisterRd</span><span class="w"> </span><span class="p">!</span><span class="err">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="nf">and</span><span class="w"> </span><span class="no">not</span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegWrite</span><span class="w"> </span><span class="no">and</span><span class="w"> </span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegisterRd</span><span class="w"> </span><span class="p">!</span><span class="err">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="nf">and</span><span class="w"> </span><span class="p">(</span><span class="no">EX</span><span class="err">/</span><span class="no">MEM.RegisterRd</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">ID</span><span class="err">/</span><span class="no">EX.RegisterRs2</span><span class="p">))</span>
<span class="nf">and</span><span class="w"> </span><span class="p">(</span><span class="no">MEM</span><span class="err">/</span><span class="no">WB.RegisterRd</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">ID</span><span class="err">/</span><span class="no">EX.RegisterRs2</span><span class="p">))</span><span class="w"> </span><span class="no">ForwardB</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">01</span>
</code></pre></div>
</li>
</ol>
<p>可以注意到，MEM 冒险需要保证在不发生 EX 冒险时才发生。</p>
<h3 id="_23">停顿</h3>
<p>当一条指令试图在加载指令写入一个寄存器之后读取这个寄存器时，前递不能解决此处的冒险。下面这样一个例子就表明了这一问题：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_27.png" width="70%" style="margin: 0 auto;">
</div>

<p>可见，当加载指令后跟着一条需要读取加载指令结果的指令时，流水线必须被阻塞以消除这种指令组合带来的冒险。因此，除了一个前递单元外，还需要一个冒险检测单元。该单元在 ID 流水线阶段操作，从而可以在加载指令和相关加载指令结果的指令之间加入一个流水线阻塞。这个单元检测加载指令，冒险控制单元的控制逻辑满足如下条件：</p>
<div class="highlight"><pre><span></span><code><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="no">ID</span><span class="err">/</span><span class="no">EX.MemRead</span>
<span class="nf">and</span><span class="w"> </span><span class="p">((</span><span class="no">ID</span><span class="err">/</span><span class="no">EX.RegisterRd</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">IF</span><span class="err">/</span><span class="no">ID.RegisterRs1</span><span class="p">)</span>
<span class="w">    </span><span class="nf">or</span><span class="w"> </span><span class="p">(</span><span class="no">ID</span><span class="err">/</span><span class="no">EX.RegisterRd</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">IF</span><span class="err">/</span><span class="no">ID.RegisterRs2</span><span class="p">)))</span>
<span class="w">    </span><span class="nf">stall</span><span class="w"> </span><span class="no">the</span><span class="w"> </span><span class="no">pipeline</span>
</code></pre></div>
<p>如果处于 ID 阶段的指令被停顿了，那么在 IF 阶段中的指令也一定要被停顿，否则已经渠道的指令就会丢失。这需要我们将某些指令替换为<strong>空指令</strong> (nops) 来实现。现在，我们可以来看一看开头那个需要插入停顿的例子应该如何运行：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_28.png" width="70%" style="margin: 0 auto;">
</div>

<p>同时，我们给出完整的具有 2 个前递多选器、1 个冒险检测单元和 1 个前递单元的流水线控制图：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_29.png" width="70%" style="margin: 0 auto;">
</div>

<h2 id="_24">控制冒险的处理</h2>
<p>另一个常见的流水线冒险发生在条件分支，也就是控制冒险或分支冒险。下图展示了一个发生控制冒险的例子：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_30.png" width="70%" style="margin: 0 auto;">
</div>

<p>接下来将介绍两种解决控制冒险的方案和一种提升解决方案性能的优化方法。</p>
<h3 id="_25">假设分支不发生</h3>
<p>一种提升分支阻塞效率的方法是预测条件分支不发生并持续执行顺序指令流。一旦条件分支发生，已经被读取和译码的指令就将被丢弃，流水线继续从分支目标处开始执行。如果条件分支不发生的概率很大（例如循环的跳出），同时丢弃指令的代价又很小，那么这种优化方式带来的提升是显著的。</p>
<p>想要丢弃指令，只需要将初始控制值变为 <span class="arithmatex">\(0\)</span> 即可。具体来说，这需要我们改变当分支指令到达 MEM 阶段时 IF、ID 和 EX 阶段的 3 条指令，也就是<strong>清除</strong> (flush) 这 3 条指令。</p>
<h3 id="_26">缩短分支延迟</h3>
<p>一种提升条件分支性能的方式是减少发生分支时所需的代价。到目前为止，我们假定分支所需的下一 PC 值在 MEM 阶段才能被获取，但如果我们将流水线中的条件分支指令提早移动执行，就可以刷新更少的指令。</p>
<p>要将分支决定向前移动，需要两个操作提早发生：计算分支目标地址和判断分支条件。前者是相对简单的，因为在 IF/ID 流水线寄存器中就已经有 PC 值和立即数字段，所以只需将分支地址从 EX 阶段移动到 ID 阶段即可。困难的部分是分支决定本身。对于相等时跳转指令，这需要在 ID 阶段比较两个寄存器中的值是否相等。</p>
<p>具体来说，这里存在两个复杂的因素。一是需要在 ID 阶段将指令译码，决定是否需要将指令旁路至相等检测单元；二是在 ID 阶段分支比较所需的值可能在之后才会产生，因此可能会产生数据冒险，所以指令停顿也是必需的。</p>
<p>尽管这很困难，但是将条件分支指令的执行移动到 ID 阶段的确是一个有效的优化。为了清楚 IF 阶段的指令，我们添加了一条称作 <code>IF.Flush</code> 的控制线，它将 IF/ID 流水线寄存器中的指令字段设置为 <span class="arithmatex">\(0\)</span>。将寄存器清空的结果是将已经取到的指令转换成一条 <code>nop</code> 指令，该指令不进行任何操作，也不改变任何状态。</p>
<h3 id="_27">动态分支预测</h3>
<p>假定条件分支不发生是一种简单的静态预测机制，在复杂的流水线中，这种机制容易产生较大的性能浪费。于是相对地，我们尝试在程序执行的过程中，使用运行信息进行分支预测，这就是<strong>动态分支预测</strong> (dynamic branch prediction)。</p>
<p>动态分支预测一般基于<strong>分支预测缓存</strong> (branch prediction buffer) 和<strong>分支历史表</strong> (branch history)。</p>
<p>最简单分支预测缓存只有 1 个比特位，即存储上一次该分支是否发生跳转，并据此预测下一次分支执行的情况。但是这个方案的缺点是明显的：即当一个条件分支发生状态变化时，会造成 2 次预测错误而不只 1 次。</p>
<p>一个有效的改进称作 2 位预测机制，即记录过去两次分支是否跳转，并只在连续两次预测错误时再改变预测。理论上，这种预测的正确率可以达到 <span class="arithmatex">\(75\%\)</span>。这个过程可以表示为下图的状态自动机：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_31.png" width="70%" style="margin: 0 auto;">
</div>

<p>上述的两种预测器都称作<strong>相关预测器</strong> (correlating predictors)。还有一种高级的预测器称作<strong>锦标赛分支预测器</strong> (tournament branch predictor)，就是对于每个分支使用多种预测器，记录它们累计的预测正确率，并总是采用其中最准确的那个作为预测结果。</p>
<p>到这里，我们已经基本讨论完了流水线处理器的基本架构，下图是综合的数据通路和控制图：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_32.png" width="70%" style="margin: 0 auto;">
</div>

<h2 id="_28">例外</h2>
<p>控制逻辑是处理器设计中最有挑战的部分：验证正确性最为困难，同时也最难进行时序优化。<strong>例外</strong> (exception) 和<strong>中断</strong> (interrupt) 是控制逻辑需要实现的任务之一。除分支指令外，它式另一种改变指令执行控制流的方式。</p>
<h3 id="risc-v_1">RISC-V 中如何处理例外</h3>
<p>在目前所讲过的实现中，只存在两种例外类型：未定义指令和硬件故障。</p>
<p>当例外发生时，处理器必须执行的基本动作是：在<strong>系统例外程序计数器</strong> (Supervisor Exception Program Counter, SEPC) 中保存发生例外的指令地址，同时将控制权转交给操作系统。之后，操作系统将做出相应动作。完成例外处理的所有操作后，操作系统使用 SEPC 寄存器中的内容重启程序的正常执行。可能是继续执行源程序，也可能是终止程序。</p>
<p>操作系统进行例外处理，除了引发例外的指令外，还必须获得例外发生的原因。第一种方法，也是 RISC-V 中使用的方法是设置<strong>系统例外原因寄存器</strong> (Supervisor Exception Cause Register, SCAUSE)，该寄存器中记录了例外原因。另一种方法是使用<strong>向量式中断</strong> (vectored interrupt)，该方法用基址寄存器加上例外原因（作为偏移）作为目标地址来完成控制流转换，从而让操作系统根据例外向量起始地址来确定例外原因。</p>
<p>通过添加一些额外寄存器和控制信号，并稍微扩展控制逻辑，就可以完成对各种例外的处理。</p>
<h3 id="_29">流水线实现中的例外</h3>
<p>流水线实现中，将例外处理看作是一种特殊的控制冒险。当例外发生时，我们需要在流水线上清除掉发生例外的指令后的指令，并从新地址开始取指。与处理分支指令不同的是，例外会引起系统状态的变化。</p>
<p>具体来说：</p>
<ul>
<li>处理分支预测错误时，我们将取值阶段的指令变为空操作 <code>nop</code>，以此来消除影响。</li>
<li>对于进入译码阶段的指令，增加新逻辑控制译码阶段的多选器使输出为 <span class="arithmatex">\(0\)</span>，流水线停顿。添加一个新的控制信号 ID.Flush，它与来自于冒险检测单元的 stall 信号进行或运算，使用该信号对进入译码阶段的指令进行清除。</li>
<li>对于进入执行阶段的指令，我们使用一个新的控制信号 EX.Flush，使得多选器输出为 <span class="arithmatex">\(0\)</span>。并预先指定一个例外入口地址（RISC-V 中为 <code>0x0000 0000 1C09 0000</code>）。为保证从正确地址开始取指，我们为 PC 多选器新增一个输入，保证能将上述例外入口地址送给 PC 寄存器。</li>
</ul>
<p>加入了如上针对例外处理的改进后，我们的数据通路和控制信号如下图：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_37.png" width="70%" style="margin: 0 auto;">
</div>

<p>进一步地，同一个周期内可以同时发生多个例外。解决方案是，对例外进行优先级排列，便于判断服务顺序。在 RISC-V 中，这一步骤由硬件实现。最后，SPEC 寄存器保存引发例外的指令的地址，SCAUSE 寄存器记录当前最高优先级的例外信息。</p>
<h2 id="_30">指令间的并行性</h2>
<p>流水线技术挖掘了指令间潜在的并行性，这被称作<strong>指令级并行</strong> (instruction-level parallelism, ILP)。提高指令级并行度主要有两种方法。第一种是增加流水线的级数，让更多的指令重叠执行。另一种提到指令并行度的方法是增加流水线内部的功能部件数量，这样可以每周期发出多条指令，这种技术称作<strong>多发射</strong> (multiple issue)。</p>
<p>每周期发射多条指令，可以使得指令执行频率超过时钟频率。实现多发射处理器主要有两种方法，区别在于编译器和硬件的不同分工。如果指令发射与否的判断是在编译时完成的，就称作<strong>静态多发射</strong> (static multiple issue)。如果指令发射与否的判断是在动态执行过程中由硬件完成的，就称作<strong>动态多发射</strong> (dynamic multiple issue)。</p>
<h3 id="_31">推测</h3>
<p><strong>推测</strong> (speculation) 是一种非常重要的深度挖掘指令级并行的方法。以预测思想为基础，推测方法允许编译器或处理器来「猜测」指令的行为，并允许其它于被推测指令相关的指令提前开始执行。</p>
<p>推测可以在编译时完成，也可以在执行时由硬件完成。但是无论是在何时推测，实现推测错误时的恢复机制非常困难。而且推测式执行还会引入另一个问题，即对某条指令进行推测可能引入不必要的例外。总而言之，不恰当的推测可能会反而降低处理器的性能。因此，正确的、有效的推测技术是推测能够改善处理器性能的关键。</p>
<h3 id="_32">静态多发射</h3>
<p>静态多发射处理器是由编译器来支持指令打包和处理指令间的冒险。对于静态多发射处理器，可以将同一周期发射出去的指令集合，即<strong>发射指令包</strong> (issue packet) 看成一条需要进行多种操作的「大指令」，这正符合<strong>超长指令字</strong> (Very Long Instruction Word, VLIW) 的设计思路。</p>
<p>静态多发射处理器对于潜在的数据和控制冒险有不同的解决方案。在一些设计实现中，由编译器来实现所有冒险的解决、代码的调度以及插入相应的 <code>nop</code>；而在另一些设计实现中，使用硬件来检测两个指令包之间的数据冒险，并产生相应的流水线停顿。后文我们假设使用的是第二种方法。</p>
<p>如果想同时发射 ALU 和数据传输类指令，除了上文所说的冒险检测和流水线停顿逻辑，首先需要添加的硬件资源是寄存器堆的读写口，为 ALU 指令和数据传输类指令提供两套不同的数据通路以避免结构冒险。如下图：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_33.png" width="70%" style="margin: 0 auto;">
</div>

<p>基于这个设计，我们来看一个具体的双发射流水线的例子。</p>
<blockquote>
<p>对于以下指令：</p>
<div class="highlight"><pre><span></span><code><span class="nl">Loop:</span>
<span class="w">    </span><span class="nf">ld</span><span class="w"> </span><span class="no">x31</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">(</span><span class="no">x20</span><span class="p">)</span><span class="w"> </span><span class="c1">// x31 = array element</span>
<span class="w">    </span><span class="nf">add</span><span class="w"> </span><span class="no">x31</span><span class="p">,</span><span class="w"> </span><span class="no">x31</span><span class="p">,</span><span class="w"> </span><span class="no">x21</span><span class="w"> </span><span class="c1">// add scalar in x21</span>
<span class="w">    </span><span class="nf">sd</span><span class="w"> </span><span class="no">x31</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">(</span><span class="no">x20</span><span class="p">)</span><span class="w"> </span><span class="c1">// store result</span>
<span class="w">    </span><span class="nf">addi</span><span class="w"> </span><span class="no">x20</span><span class="p">,</span><span class="w"> </span><span class="no">x20</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span><span class="w"> </span><span class="c1">// decrement pointer</span>
<span class="w">    </span><span class="nf">blt</span><span class="w"> </span><span class="no">x22</span><span class="p">,</span><span class="w"> </span><span class="no">x20</span><span class="p">,</span><span class="w"> </span><span class="no">Loop</span><span class="w"> </span><span class="c1">// branch if x20 &gt; x22</span>
</code></pre></div>
<p>我们假设可以被分支是可以被预测的，也就是控制冒险由硬件解决。于是观察指令，发现前三条指令具有数据相关，因此重点调度后两条。具体来说，我们可以这样调度：</p>
<p><div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_34.png" width="70%" style="margin: 0 auto;">
</div></p>
<p>于是就将 CPI 从 <span class="arithmatex">\(1\)</span> 降到了 <span class="arithmatex">\(0.8\)</span>。需要注意的是，由于出现了调度，所以 <code>sd</code> 指令的访存地址要发生变化，在例子中要加上 <span class="arithmatex">\(8\)</span>。</p>
</blockquote>
<p>但这个设计仍然有一些问题。例如，在简单五级流水线结构中，load 指令有一个周期的<strong>使用延迟</strong> (use latency)，而 ALU 指令本来是没有使用延迟的。但在双发射流水线中，需要同时发射 ALU 指令和 load 指令。如果这两条指令存在数据冒险，则 load 指令不能被发射，相当于 ALU 指令增加了一个周期的使用延迟。</p>
<p>于是我们还要进一步提高程序性能。<strong>循环展开</strong> (loop unrolling) 是一种专门针对循环体提高程序性能的重要编译技术。它将循环体展开多遍，从不同循环中寻找可以重叠执行的指令来挖掘更多的指令级并行性。</p>
<p>我们继续沿用上文的例子。</p>
<blockquote>
<p>我们将循环体展开 4 遍，完成重叠后再消除不必要的开销，就可以得到这样的调度结果：</p>
<p><div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_35.png" width="70%" style="margin: 0 auto;">
</div></p>
<p>与上一个例子同理，<code>ld</code> 指令的访存地址也要发生变化，先使用 <code>x20</code> 的原值，然后将地址减 <span class="arithmatex">\(8\)</span>、减 <span class="arithmatex">\(16\)</span>、减 <span class="arithmatex">\(24\)</span>。</p>
</blockquote>
<p>从例子中我们可以发现，在循环展开的过程中，编译器使用了额外的寄存器，这一行为称作<strong>寄存器重命名</strong> (register renaming)。</p>
<p>可以发现，不同循环的指令之间是没有数据依赖的，仅仅是由于名称复用导致潜在的冒险，这种情况被称作<strong>反相关</strong> (antidependence) 或<strong>名字相关</strong> (name dependence)。寄存器重命名就能解决这个问题，在循环展开时对寄存器进行重命名，可以允许编译器移动不同循环中的指令，以更好地调度代码。</p>
<p>当然，寄存器重命名可以消除名字相关，但不能消除真相关。</p>
<h3 id="_33">动态多发射</h3>
<p>动态多发射处理器也称作<strong>超标量</strong> (superscalar) 处理器或朴素的超标量处理器。在最简单的超标量处理器中，指令按顺序发射，由硬件来判断当前周期可以发射的指令数：是一条还是更多条，或者停顿发射。显然，如果想让这样的处理器活得更到的性能，仍然需要编译器进行指令调度，消除掉指令间的相关，提高指令的发射率。</p>
<p>许多超标量处理器扩展了动态发射逻辑的基础框架，形成了<strong>动态流水线调度</strong> (dynamic pipeline scheduling) 技术。动态流水线调度技术由硬件逻辑选择当前周期内执行的指令，并对指令进行重排以尽量避免流水线的冒险和停顿。</p>
<p>在动态调度中，流水线被分成 3 个主要部分：取指和发射单元、多功能部件、<strong>提交单元</strong> (commit unit)。下图给出了这种流水线的基本模型：</p>
<div style="text-align: center; margin-top: 0px;">
<img src="https://raw.githubusercontent.com/VictorWang712/Note/refs/heads/main/docs/assets/images/computer_science/computer_organisation/chapter_4_36.png" width="70%" style="margin: 0 auto;">
</div>

<p>由图可见，取值和发射单元负责取指令、译码、将各指令发送到相应的功能单元上执行。每一个功能单元前都有若干缓冲区，称为<strong>保留站</strong> (reservation stations)。保留站中存放指令的操作和所叙的操作数。只要缓冲区中指令所需操作数准备好，并且功能单元就绪，就可以执行指令。一旦指令执行结束，结果将被传送给保留站中正在等待使用该结果的指令，同时也传送到提交单元中进行保存。提交单元中保存了已完成指令的执行结果，并在真正提交时才使用它们更新寄存器或者写入内存。这些位于提交单元的缓冲区，通常被称作<strong>重排序缓冲</strong> (reorder buffer)。和静态调度流水线中的前递逻辑一样，重排序缓冲也可以用来为其它指令提供操作数。一旦指令提交，寄存器得到更新，就和正常流水线一样直接从寄存器获取最新的数据。</p>
<p>在保留站中保存操作数，以及重排序缓冲中保存运算结果，两者共同提供了一种寄存器重命名方式。考虑一下步骤：</p>
<ol>
<li>发射指令时，指令会被拷贝到相应功能单元的保留站中。同时，如果指令所需的操作数已准备好，也会从寄存器堆或者重排序缓冲中拷贝到保留站中。指令会一直保存在保留站中，指导所叙的操作数全部准备好，并且相应功能部件可用。对于处在发射阶段的指令，由于可用操作数已被拷贝至保留站中，他们在寄存器堆中的副本就无须保存了，如果出现相应寄存器的写操作，那么该寄存器中的数值将被更新。</li>
<li>如果操作数不在寄存器堆或者重排序缓冲中，那它一定在等待某个功能单元的计算结果。该功能单元的名字将被记录。当最终结果计算完毕，将会直接从功能单元拷贝到等待该结果的保留站中，即直接旁路了寄存器堆。</li>
</ol>
<p>从概念上讲，可以把动态调度流水线看作程序的数据流结构分析。处理器在不违背程序员有的数据流顺序的前提下以某种顺序执行指令，被称作<strong>乱序执行</strong> (out-of-order execution)。这是因为这样执行的指令顺序和取指的顺序是不同的。</p>
<p>为使得程序行为与简单的按序单发射流水线一致，乱序执行流水线的取指和译码都需要按需执行，一边正确处理指令间的相关。同样，提交阶段也需要按照取指的顺序依次将指令执行的结果写入寄存器和存储中。这种保守的处理方法称作<strong>按序提交</strong> (in-order commit)。如果发生例外，处理器很容易就能找到例外前的最后一条指令，也会保证只更新在此之前的指令需要改写的寄存器。</p>
<p>总的来说，虽然流水线的前端（取指和译码阶段）和后端（提交阶段）都是按序执行，但是功能部件是允许乱序执行的。任何时候只要所需数据准备好，指令就可以被发射到功能部件上开始执行。</p>







  
  






  <!-- <h2 id="__comments">Comments</h2> -->
  <!-- Insert generated snippet here -->
    <script src="https://giscus.app/client.js"
            data-repo="VictorWang712/Note"
            data-repo-id="R_kgDONsUD6w"
            data-category="Announcements"
            data-category-id="DIC_kwDONsUD684CmR5S"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="0"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="preferred_color_scheme"
            data-lang="en"
            crossorigin="anonymous"
            async>
    </script>
  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Walker_V
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/VictorWang712/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://space.bilibili.com/59307750/" target="_blank" rel="noopener" title="space.bilibili.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1-17.2 17-39.1 25.9-65.5 26.7H92c-26.4-.8-48.2-9.8-65.3-27.2S.7 396.5 0 368.2V169.8c.8-26 9.7-47.6 26.7-65.7C43.8 87.8 65.5 78.8 92 78h29.4L96 52.2c-5.7-5.7-8.6-13-8.6-21.8S90.3 14.3 96 8.6 109 0 117.9 0s16.1 2.9 21.9 8.6L213.1 78h88l74.5-69.4C381.7 2.9 389.2 0 398 0s16.1 2.9 21.9 8.6c5.7 5.7 8.6 13 8.6 21.8s-2.9 16.1-8.6 21.8L394.6 78h29.3c26.4.8 48 9.8 64.7 26.1m-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5-5.2-6.1-14-9.4-22.7-9.8H96c-9.6.4-17.4 3.7-23.6 9.8-6.1 6.1-9.4 13.9-9.8 23.5v194.4c0 9.2 3.3 17 9.8 23.5s14.4 9.8 23.6 9.8h320.4c9.2 0 17-3.3 23.3-9.8s9.7-14.3 10.1-23.5zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2-6.2 6.3-14 9.5-23.6 9.5s-17.5-3.2-23.6-9.5-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2s13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10m191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2s-14 9.5-23.6 9.5-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2s14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<victorwang712@zju.edu.cn>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M536.4-26.3c9.8-3.5 20.6-1 28 6.3s9.8 18.2 6.3 28l-178 496.9c-5 13.9-18.1 23.1-32.8 23.1-14.2 0-27-8.6-32.3-21.7l-64.2-158c-4.5-11-2.5-23.6 5.2-32.6l94.5-112.4c5.1-6.1 4.7-15-.9-20.6s-14.6-6-20.6-.9l-112.4 94.3c-9.1 7.6-21.6 9.6-32.6 5.2L38.1 216.8c-13.1-5.3-21.7-18.1-21.7-32.3 0-14.7 9.2-27.8 23.1-32.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.indexes", "navigation.tracking", "navigation.tabs", "content.code.copy", "content.code.select"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>